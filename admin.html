<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Blog Admin — Christopher Austin · On the Fairway</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400;1,600&family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;1,300;1,400&family=Crimson+Pro:wght@300;400&display=swap" rel="stylesheet">
<style>
  :root {
    --green-deep: #1a3325;
    --green-mid: #2d5a3d;
    --green-light: #4a7c5e;
    --gold: #b8965a;
    --gold-light: #d4b07a;
    --cream: #f5f0e8;
    --cream-dark: #ede5d4;
    --white: #fdfaf5;
    --text-dark: #1c1a16;
    --text-mid: #4a4540;
    --text-light: #7a7068;
    --border: rgba(184,150,90,0.25);
    --red: #9b3333;
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  html { scroll-behavior:smooth; }
  body { background:var(--cream); color:var(--text-dark); font-family:'Crimson Pro',Georgia,serif; font-size:17px; line-height:1.7; overflow-x:hidden; }

  /* ── NAV ── */
  nav {
    position:fixed; top:0; left:0; right:0; z-index:100;
    background:rgba(26,51,37,0.97); backdrop-filter:blur(8px);
    border-bottom:1px solid rgba(184,150,90,0.3);
    padding:0 4rem; display:flex; align-items:center; justify-content:space-between; height:64px;
  }
  .nav-logo { font-family:'Playfair Display',serif; font-size:1.05rem; color:var(--gold-light); letter-spacing:0.06em; text-decoration:none; font-style:italic; }
  .nav-links { display:flex; gap:2.5rem; list-style:none; }
  .nav-links a { color:rgba(245,240,232,0.72); text-decoration:none; font-family:'Cormorant Garamond',serif; font-size:0.82rem; letter-spacing:0.14em; text-transform:uppercase; transition:color 0.25s; }
  .nav-links a:hover, .nav-links a.active { color:var(--gold-light); }

  /* ── LOGIN GATE ── */
  #login-screen {
    min-height:100vh; display:flex; align-items:center; justify-content:center; padding:2rem;
  }
  .login-card {
    background:var(--white); border:1px solid var(--border); padding:3rem;
    max-width:400px; width:100%; text-align:center;
  }
  .login-icon { font-size:2rem; margin-bottom:1.25rem; opacity:0.6; }
  .login-card h2 { font-family:'Playfair Display',serif; font-size:1.6rem; color:var(--green-deep); margin-bottom:0.5rem; }
  .login-card p { font-family:'Cormorant Garamond',serif; font-size:0.95rem; color:var(--text-light); margin-bottom:2rem; }
  .login-error { color:var(--red); font-family:'Cormorant Garamond',serif; font-size:0.88rem; margin-top:0.75rem; display:none; }

  /* ── FORMS ── */
  .field { margin-bottom:1.5rem; text-align:left; }
  label { display:block; font-family:'Cormorant Garamond',serif; font-size:0.72rem; letter-spacing:0.2em; text-transform:uppercase; color:var(--text-light); margin-bottom:0.5rem; }
  input[type=text], input[type=password], textarea {
    width:100%; background:var(--white); border:1px solid var(--border);
    padding:0.75rem 1rem; font-family:'Crimson Pro',Georgia,serif; font-size:1rem; color:var(--text-dark);
    outline:none; transition:border-color 0.2s; resize:vertical;
  }
  input[type=text]:focus, input[type=password]:focus, textarea:focus {
    border-color:var(--gold);
  }
  textarea { min-height:320px; line-height:1.75; }

  /* ── BUTTONS ── */
  .btn {
    display:inline-flex; align-items:center; gap:0.5rem;
    font-family:'Cormorant Garamond',serif; font-size:0.8rem; letter-spacing:0.18em; text-transform:uppercase;
    border:none; cursor:pointer; padding:0.75rem 1.8rem; transition:all 0.2s;
  }
  .btn-primary { background:var(--green-deep); color:var(--gold-light); }
  .btn-primary:hover { background:var(--green-mid); }
  .btn-gold { background:var(--gold); color:var(--green-deep); }
  .btn-gold:hover { background:var(--gold-light); }
  .btn-outline {
    background:none; border:1px solid var(--border); color:var(--text-light);
  }
  .btn-outline:hover { background:var(--cream-dark); color:var(--text-mid); }
  .btn-danger { background:none; border:1px solid rgba(155,51,51,0.35); color:var(--red); }
  .btn-danger:hover { background:rgba(155,51,51,0.08); }
  .btn-sm { padding:0.4rem 0.9rem; font-size:0.72rem; }

  /* ── LAYOUT ── */
  .admin-wrap { padding-top:64px; min-height:100vh; display:flex; flex-direction:column; }
  .admin-body { display:grid; grid-template-columns:320px 1fr; flex:1; gap:0; }

  /* ── SIDEBAR ── */
  .sidebar {
    background:var(--white); border-right:1px solid var(--border);
    padding:2rem 0; display:flex; flex-direction:column;
    min-height:calc(100vh - 64px); position:sticky; top:64px;
    height:calc(100vh - 64px); overflow-y:auto;
  }
  .sidebar-header {
    padding:0 1.5rem 1.5rem; border-bottom:1px solid var(--border);
  }
  .sidebar-label {
    font-family:'Cormorant Garamond',serif; font-size:0.65rem; letter-spacing:0.28em; text-transform:uppercase;
    color:var(--gold); margin-bottom:1rem; display:flex; align-items:center; gap:0.5rem;
  }
  .sidebar-label::after { content:''; display:block; width:20px; height:1px; background:var(--gold); opacity:0.5; }
  .new-post-btn { width:100%; }

  .post-list-wrap { padding:1.5rem 0; flex:1; }
  .post-list-label {
    font-family:'Cormorant Garamond',serif; font-size:0.65rem; letter-spacing:0.24em; text-transform:uppercase;
    color:var(--text-light); padding:0 1.5rem; margin-bottom:0.75rem;
  }

  .post-item {
    padding:0.85rem 1.5rem; cursor:pointer; border-left:3px solid transparent;
    transition:all 0.15s; border-bottom:1px solid rgba(184,150,90,0.1);
  }
  .post-item:hover { background:var(--cream); }
  .post-item.active { border-left-color:var(--gold); background:var(--cream); }
  .post-item-title {
    font-family:'Playfair Display',serif; font-size:0.95rem; color:var(--green-deep);
    line-height:1.3; margin-bottom:0.25rem;
    white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
  }
  .post-item-meta {
    font-family:'Cormorant Garamond',serif; font-size:0.72rem; color:var(--text-light);
    display:flex; align-items:center; gap:0.4rem;
  }
  .status-badge {
    font-family:'Cormorant Garamond',serif; font-size:0.6rem; letter-spacing:0.12em; text-transform:uppercase;
    padding:0.1rem 0.45rem; border-radius:2px;
  }
  .status-badge.published { background:rgba(45,90,61,0.12); color:var(--green-mid); }
  .status-badge.draft { background:rgba(122,112,104,0.12); color:var(--text-light); }

  /* ── EDITOR ── */
  .editor-pane {
    padding:2.5rem 3rem;
    max-width:820px;
  }
  .editor-toolbar {
    display:flex; align-items:center; justify-content:space-between;
    margin-bottom:2rem; flex-wrap:wrap; gap:1rem;
  }
  .editor-title-block h2 {
    font-family:'Playfair Display',serif; font-size:1.5rem; color:var(--green-deep);
  }
  .editor-title-block p {
    font-family:'Cormorant Garamond',serif; font-size:0.88rem; color:var(--text-light); margin-top:0.2rem;
  }
  .editor-actions { display:flex; gap:0.75rem; flex-wrap:wrap; }

  .editor-form { display:flex; flex-direction:column; gap:0; }

  .char-count {
    font-family:'Cormorant Garamond',serif; font-size:0.75rem; color:var(--text-light);
    text-align:right; margin-top:0.35rem;
  }

  /* ── TOAST ── */
  #toast {
    position:fixed; bottom:2rem; right:2rem; z-index:999;
    background:var(--green-deep); color:var(--gold-light);
    font-family:'Cormorant Garamond',serif; font-size:0.9rem; letter-spacing:0.06em;
    padding:0.85rem 1.5rem; border:1px solid rgba(184,150,90,0.3);
    opacity:0; transform:translateY(12px); transition:all 0.3s;
    pointer-events:none;
  }
  #toast.show { opacity:1; transform:none; }
  #toast.error { background:#4a1a1a; color:#e89a9a; border-color:rgba(155,51,51,0.3); }

  /* ── DELETE CONFIRM ── */
  .confirm-overlay {
    display:none; position:fixed; inset:0; z-index:200;
    background:rgba(10,20,15,0.6); align-items:center; justify-content:center;
  }
  .confirm-overlay.show { display:flex; }
  .confirm-card {
    background:var(--white); border:1px solid var(--border); padding:2.5rem;
    max-width:400px; width:90%; text-align:center;
  }
  .confirm-card h3 { font-family:'Playfair Display',serif; font-size:1.3rem; color:var(--green-deep); margin-bottom:0.75rem; }
  .confirm-card p { font-family:'Cormorant Garamond',serif; font-size:0.95rem; color:var(--text-light); margin-bottom:2rem; }
  .confirm-actions { display:flex; gap:0.75rem; justify-content:center; }

  .placeholder-state {
    display:flex; flex-direction:column; align-items:center; justify-content:center;
    height:100%; min-height:400px; text-align:center; color:var(--text-light);
  }
  .placeholder-state .ico { font-size:2.5rem; opacity:0.3; margin-bottom:1.5rem; }
  .placeholder-state h3 { font-family:'Playfair Display',serif; font-size:1.3rem; color:var(--green-deep); margin-bottom:0.5rem; }
  .placeholder-state p { font-family:'Cormorant Garamond',serif; font-size:0.95rem; }

  @media(max-width:900px){
    nav { padding:0 1.5rem; }
    .nav-links { display:none; }
    .admin-body { grid-template-columns:1fr; }
    .sidebar { position:static; height:auto; min-height:auto; }
    .editor-pane { padding:1.5rem; }
  }
</style>
</head>
<body>

<!-- NAV -->
<nav>
  <a href="index.html" class="nav-logo">Christopher Austin · On the Fairway</a>
  <ul class="nav-links">
    <li><a href="index.html#home-club">Home Club</a></li>
    <li><a href="index.html#rounds">Rounds</a></li>
    <li><a href="index.html#goals">2026 Goals</a></li>
    <li><a href="index.html#gallery">Gallery</a></li>
    <li><a href="index.html#about">The Game</a></li>
    <li><a href="blog.html" class="active">Blog</a></li>
  </ul>
</nav>

<!-- LOGIN GATE -->
<div id="login-screen" style="display:none;">
  <div class="login-card">
    <div class="login-icon">⛳</div>
    <h2>Blog Admin</h2>
    <p>Enter your password to manage blog posts.</p>
    <div class="field">
      <label for="pw-input">Password</label>
      <input type="password" id="pw-input" placeholder="Password" autocomplete="current-password">
    </div>
    <button class="btn btn-primary" style="width:100%;" onclick="doLogin()">Enter</button>
    <div class="login-error" id="login-error">Incorrect password. Try again.</div>
  </div>
</div>

<!-- ADMIN INTERFACE -->
<div id="admin-screen" class="admin-wrap" style="display:none;">
  <div class="admin-body">

    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-label">Blog Admin</div>
        <button class="btn btn-gold new-post-btn" onclick="newPost()">+ New Post</button>
      </div>
      <div class="post-list-wrap">
        <div class="post-list-label">All Posts</div>
        <div id="post-list"></div>
      </div>
    </aside>

    <!-- EDITOR PANE -->
    <main class="editor-pane">
      <div id="editor-placeholder" class="placeholder-state">
        <div class="ico">✍️</div>
        <h3>Ready to write?</h3>
        <p>Select a post to edit or click <em>New Post</em> to get started.</p>
      </div>

      <div id="editor-form-wrap" style="display:none;">
        <div class="editor-toolbar">
          <div class="editor-title-block">
            <h2 id="editor-heading">New Post</h2>
            <p id="editor-subheading">Fill in the details below.</p>
          </div>
          <div class="editor-actions">
            <button class="btn btn-outline btn-sm" onclick="saveDraft()">Save Draft</button>
            <button class="btn btn-primary btn-sm" id="publish-btn" onclick="togglePublish()">Publish</button>
            <button class="btn btn-danger btn-sm" onclick="confirmDelete()">Delete</button>
          </div>
        </div>

        <div class="editor-form">
          <div class="field">
            <label for="f-title">Title</label>
            <input type="text" id="f-title" placeholder="Post title…" maxlength="200" oninput="titleCount()">
            <div class="char-count" id="title-count">0 / 200</div>
          </div>
          <div class="field">
            <label for="f-author">Author</label>
            <input type="text" id="f-author" placeholder="Your name…" maxlength="100">
          </div>
          <div class="field">
            <label for="f-body">Body</label>
            <textarea id="f-body" placeholder="Write your post here…" oninput="bodyCount()"></textarea>
            <div class="char-count" id="body-count">0 chars</div>
          </div>
        </div>
      </div>
    </main>
  </div>
</div>

<!-- DELETE CONFIRM OVERLAY -->
<div class="confirm-overlay" id="confirm-overlay">
  <div class="confirm-card">
    <h3>Delete this post?</h3>
    <p>This action cannot be undone. The post will be permanently removed.</p>
    <div class="confirm-actions">
      <button class="btn btn-outline" onclick="closeConfirm()">Cancel</button>
      <button class="btn btn-danger" onclick="doDelete()">Delete</button>
    </div>
  </div>
</div>

<!-- TOAST -->
<div id="toast"></div>

<script>
/* ── Storage helpers ── */
const STORAGE_KEY = 'golf_blog_posts';
const SESSION_KEY = 'golf_admin_auth';
// Default password — change by setting localStorage key 'golf_admin_pw' to your chosen value
const DEFAULT_PW  = 'fairway2026';

function getPosts() {
  try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]'); } catch { return []; }
}
function savePosts(posts) {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(posts));
}
function genId() {
  return Date.now().toString(36) + Math.random().toString(36).slice(2, 8);
}

/* ── Auth ── */
function getPassword() {
  return localStorage.getItem('golf_admin_pw') || DEFAULT_PW;
}
function isAuthed() {
  return sessionStorage.getItem(SESSION_KEY) === 'yes';
}
function doLogin() {
  const val = document.getElementById('pw-input').value;
  if (val === getPassword()) {
    sessionStorage.setItem(SESSION_KEY, 'yes');
    showAdmin();
  } else {
    document.getElementById('login-error').style.display = 'block';
    document.getElementById('pw-input').value = '';
    document.getElementById('pw-input').focus();
  }
}
document.getElementById('pw-input').addEventListener('keydown', e => {
  if (e.key === 'Enter') doLogin();
});

/* ── Boot ── */
(function boot() {
  if (isAuthed()) {
    showAdmin();
  } else {
    document.getElementById('login-screen').style.display = 'flex';
  }
})();

/* ── State ── */
let currentId = null; // id of post being edited

function showAdmin() {
  document.getElementById('login-screen').style.display = 'none';
  document.getElementById('admin-screen').style.display = 'flex';
  renderSidebar();

  // Auto-open post from ?edit=id
  const params = new URLSearchParams(window.location.search);
  const editId = params.get('edit');
  if (editId) {
    const posts = getPosts();
    const p = posts.find(x => x.id === editId);
    if (p) openPost(editId);
  }
}

/* ── Sidebar ── */
function renderSidebar() {
  const posts = getPosts().sort((a,b) => new Date(b.updatedAt) - new Date(a.updatedAt));
  const list = document.getElementById('post-list');
  if (posts.length === 0) {
    list.innerHTML = `<div style="padding:1rem 1.5rem;font-family:'Cormorant Garamond',serif;font-size:0.88rem;color:var(--text-light);font-style:italic;">No posts yet.</div>`;
    return;
  }
  list.innerHTML = posts.map(p => `
    <div class="post-item ${p.id === currentId ? 'active' : ''}" onclick="openPost('${p.id}')">
      <div class="post-item-title">${escHtml(p.title || 'Untitled')}</div>
      <div class="post-item-meta">
        <span class="status-badge ${p.published ? 'published' : 'draft'}">${p.published ? 'Published' : 'Draft'}</span>
        <span>·</span>
        <span>${shortDate(p.updatedAt)}</span>
      </div>
    </div>
  `).join('');
}

/* ── New Post ── */
function newPost() {
  const id = genId();
  const now = new Date().toISOString();
  const post = {
    id, title: '', body: '', author: 'Christopher Austin',
    published: false, publishedAt: null,
    createdAt: now, updatedAt: now
  };
  const posts = getPosts();
  posts.unshift(post);
  savePosts(posts);
  currentId = id;
  renderSidebar();
  openEditor(post);
  document.getElementById('f-title').focus();
}

/* ── Open existing post ── */
function openPost(id) {
  const posts = getPosts();
  const post = posts.find(p => p.id === id);
  if (!post) return;
  currentId = id;
  renderSidebar();
  openEditor(post);
}

function openEditor(post) {
  document.getElementById('editor-placeholder').style.display = 'none';
  document.getElementById('editor-form-wrap').style.display = 'block';

  document.getElementById('editor-heading').textContent = post.published ? 'Edit Post' : 'Edit Draft';
  document.getElementById('editor-subheading').textContent = post.published
    ? `Published · ${formatDate(post.publishedAt)}`
    : 'Not yet published';

  document.getElementById('f-title').value = post.title || '';
  document.getElementById('f-author').value = post.author || '';
  document.getElementById('f-body').value = post.body || '';

  const pubBtn = document.getElementById('publish-btn');
  if (post.published) {
    pubBtn.textContent = 'Unpublish';
    pubBtn.className = 'btn btn-outline btn-sm';
  } else {
    pubBtn.textContent = 'Publish';
    pubBtn.className = 'btn btn-primary btn-sm';
  }
  titleCount(); bodyCount();
}

/* ── Save helpers ── */
function readForm() {
  return {
    title: document.getElementById('f-title').value.trim(),
    author: document.getElementById('f-author').value.trim(),
    body: document.getElementById('f-body').value,
  };
}

function validate() {
  const { title, author, body } = readForm();
  if (!title) { showToast('Title is required.', true); return false; }
  if (!author) { showToast('Author is required.', true); return false; }
  if (!body.trim()) { showToast('Body is required.', true); return false; }
  return true;
}

function saveDraft() {
  if (!currentId) return;
  const { title, author, body } = readForm();
  const posts = getPosts();
  const idx = posts.findIndex(p => p.id === currentId);
  if (idx === -1) return;
  const now = new Date().toISOString();
  posts[idx] = { ...posts[idx], title, author, body, updatedAt: now };
  savePosts(posts);
  renderSidebar();
  openEditor(posts[idx]);
  showToast('Draft saved.');
}

function togglePublish() {
  if (!currentId) return;
  if (!validate()) return;
  const { title, author, body } = readForm();
  const posts = getPosts();
  const idx = posts.findIndex(p => p.id === currentId);
  if (idx === -1) return;
  const now = new Date().toISOString();
  const wasPublished = posts[idx].published;
  posts[idx] = {
    ...posts[idx], title, author, body, updatedAt: now,
    published: !wasPublished,
    publishedAt: wasPublished ? posts[idx].publishedAt : now,
  };
  savePosts(posts);
  renderSidebar();
  openEditor(posts[idx]);
  showToast(wasPublished ? 'Post unpublished.' : 'Post published!');
}

/* ── Delete ── */
function confirmDelete() {
  document.getElementById('confirm-overlay').classList.add('show');
}
function closeConfirm() {
  document.getElementById('confirm-overlay').classList.remove('show');
}
function doDelete() {
  closeConfirm();
  if (!currentId) return;
  const posts = getPosts().filter(p => p.id !== currentId);
  savePosts(posts);
  currentId = null;
  document.getElementById('editor-placeholder').style.display = 'flex';
  document.getElementById('editor-form-wrap').style.display = 'none';
  renderSidebar();
  showToast('Post deleted.');
}

/* ── Char counts ── */
function titleCount() {
  const l = document.getElementById('f-title').value.length;
  document.getElementById('title-count').textContent = `${l} / 200`;
}
function bodyCount() {
  const l = document.getElementById('f-body').value.length;
  document.getElementById('body-count').textContent = `${l.toLocaleString()} chars`;
}

/* ── Toast ── */
let toastTimer;
function showToast(msg, error = false) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.className = 'show' + (error ? ' error' : '');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => { t.className = ''; }, 3000);
}

/* ── Utils ── */
function escHtml(s) {
  return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}
function formatDate(iso) {
  if (!iso) return '—';
  const d = new Date(iso);
  return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
}
function shortDate(iso) {
  if (!iso) return '';
  const d = new Date(iso);
  return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
}
</script>
</body>
</html>
